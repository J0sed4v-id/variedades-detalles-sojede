{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de productos</title>
    <link rel="stylesheet" href="{% static 'productos.css' %}">
</head>
<body>

    <!-- Header -->
    <header class="header-sojede">
        <div class="header-left">
            <img src="{% static 'images/logo.jpg' %}" alt="Logo Papeler√≠a">
            <nav class="nav-sojede">
                <a href="{% url 'dashboard' %}">Inicio</a>
                <a href="{% url 'productos' %}" class="active">Productos</a>
                <a href="{% url 'inventario' %}">Inventario</a>
                <a href="{% url 'compras' %}">Compras</a>
            </nav>
        </div>
        <a href="{% url 'cerrar_sesion' %}" class="btn-logout-sojede">Cerrar sesi√≥n</a>
    </header>

    <!-- Main -->
    <main class="main-sojede">
        <h2 class="section-title">Gesti√≥n de productos</h2>

        <!-- FORMULARIO PARA AGREGAR O EDITAR PRODUCTOS -->
        <div class="form-container">
            <form method="POST" action="{% url 'agregar_producto' %}">
                {% csrf_token %}
                <!-- Campo oculto para editar -->
                <input type="hidden" name="id" id="producto_id">

                <div class="form-line">
                    <label for="codigo">C√≥digo:</label>
                    <input type="text" name="codigo" id="codigo" placeholder="xx" required>

                    <label for="nombre">Nombre:</label>
                    <input type="text" name="nombre" id="nombre" placeholder="xxxxxx" required>

                    <label for="stock">Stock:</label>
                    <input type="number" name="stock" id="stock" placeholder="00" min="0" required>

                    <label for="categoria">Categor√≠a:</label>
                    <input type="text" name="categoria" id="categoria" placeholder="xxxxxx" required>

                    <button type="submit" class="btn-save" id="btnGuardar">Guardar</button>
                </div>
            </form>
        </div>

        <!-- Search -->
        <div class="search-bar">
            <form method="GET" action="{% url 'productos' %}">
                <input type="text" name="q" placeholder="Buscar productos" value="{{ request.GET.q }}">
                <button type="submit" class="btn-clear">üîç</button>
            </form>
        </div>

        <!-- Tabla de productos -->
        <table class="products-table">
            <thead>
                <tr>
                    <th>C√≥digo</th>
                    <th>Nombre</th>
                    <th>Stock</th>
                    <th>Categor√≠a</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for producto in productos %}
                <tr>
                    <td>{{ producto.codigo }}</td>
                    <td>{{ producto.nombre }}</td>
                    <td>{{ producto.stock }}</td>
                    <td>{{ producto.categoria }}</td>
                    <td class="actions">
                        <!-- Bot√≥n Editar -->
                        <a href="#" class="btn-action" 
                           onclick="editarProducto('{{ producto.id }}', '{{ producto.codigo }}', '{{ producto.nombre }}', '{{ producto.stock }}', '{{ producto.categoria }}')">‚úèÔ∏è</a>

                        <!-- Bot√≥n Eliminar -->
                        <a href="{% url 'eliminar_producto' producto.id %}" class="btn-action" 
                           onclick="return confirm('¬øSeguro que deseas eliminar este producto?')">üóëÔ∏è</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5">No hay productos registrados.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </main>

    <!-- Footer -->
    <footer class="footer-sojede">
        <p>¬© 2025 ‚Äî Sistema de Gesti√≥n de Inventario y Facturaci√≥n.</p>
        <p>soporte.sojede@gmail.com</p>
    </footer>

    <!-- Script para rellenar el formulario -->
    <script>
    function editarProducto(id, codigo, nombre, stock, categoria) {
        document.getElementById('producto_id').value = id;
        document.getElementById('codigo').value = codigo;
        document.getElementById('nombre').value = nombre;
        document.getElementById('stock').value = stock;
        document.getElementById('categoria').value = categoria;
        document.getElementById('btnGuardar').textContent = 'Actualizar';
    }

    // Restablecer el formulario al enviar
    document.querySelector('form').addEventListener('submit', function() {
        setTimeout(() => {
            document.getElementById('producto_id').value = '';
            document.getElementById('codigo').value = '';
            document.getElementById('nombre').value = '';
            document.getElementById('stock').value = '';
            document.getElementById('categoria').value = '';
            document.getElementById('btnGuardar').textContent = 'Guardar';
        }, 500);
    });
    </script>

</body>
</html>
